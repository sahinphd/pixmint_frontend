# Enhanced Shared cPanel hosting .htaccess
# Maximum compatibility for shared hosting providers

# Enable rewrite engine
RewriteEngine On
RewriteBase /

# Force HTTPS (uncomment if you have SSL)
# RewriteCond %{HTTPS} off
# RewriteCond %{HTTP_HOST} !^localhost
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Handle specific static files - let them pass through
RewriteRule ^favicon\.ico$ - [L]
RewriteRule ^robots\.txt$ - [L]
RewriteRule ^index\.html$ - [L]
RewriteRule ^200\.html$ - [L]
RewriteRule ^404\.html$ - [L]

# Handle assets directory - let all assets pass through
RewriteRule ^_nuxt/ - [L]

# Handle API calls (if any) - let them pass through
RewriteRule ^api/ - [L]

# Handle well-known directory (for SSL verification, etc.)
RewriteRule ^\.well-known/ - [L]

# Main SPA routing - fallback to index.html for everything else
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/\.well-known/
RewriteCond %{REQUEST_URI} !^/_nuxt/
RewriteRule ^.*$ /index.html [L,QSA]

# Security headers (conservative for shared hosting)
<IfModule mod_headers.c>
    # Basic security
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options SAMEORIGIN
    Header always set X-XSS-Protection "1; mode=block"
    
    # Cache control for assets
    <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp)$">
        Header set Cache-Control "public, max-age=2592000"
        Header set Expires "access plus 30 days"
    </FilesMatch>
    
    # Cache control for HTML
    <FilesMatch "\.(html|htm)$">
        Header set Cache-Control "public, max-age=3600"
        Header set Expires "access plus 1 hour"
    </FilesMatch>
</IfModule>

# Compression (if supported)
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain text/html text/xml text/css
    AddOutputFilterByType DEFLATE application/xml application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript application/json
    AddOutputFilterByType DEFLATE image/svg+xml
</IfModule>

# Alternative compression for older servers
<IfModule mod_gzip.c>
    mod_gzip_on Yes
    mod_gzip_dechunk Yes
    mod_gzip_item_include file \.(html?|txt|css|js|php|pl|json)$
    mod_gzip_item_include mime ^text/.*
    mod_gzip_item_include mime ^application/x-javascript.*
    mod_gzip_item_exclude rspheader ^Content-Encoding:.*gzip.*
</IfModule>

# MIME types for web fonts
<IfModule mod_mime.c>
    AddType application/font-woff2 .woff2
    AddType application/font-woff .woff
    AddType application/vnd.ms-fontobject .eot
    AddType font/truetype .ttf
    AddType font/opentype .otf
    AddType image/svg+xml .svg
</IfModule>

# Prevent access to sensitive files
<FilesMatch "\.(env|git|gitignore|DS_Store|json|md|lock|log|yml|yaml)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Prevent directory browsing
Options -Indexes

# Custom error pages (fallback to index.html for SPA)
ErrorDocument 404 /index.html
ErrorDocument 403 /index.html
ErrorDocument 500 /index.html

# Disable server signature
ServerSignature Off
